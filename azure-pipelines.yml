# .NET Desktop
# Build and run tests for .NET Desktop or Windows classic desktop solutions.
# Add steps that publish symbols, save build artifacts, and more:
# https://docs.microsoft.com/azure/devops/pipelines/apps/windows/dot-net

name: DaneSpiritGOD.Suites  # build numbering format
#resources:
  #containers: [ container ]
  #repositories: [ repository ]
#variables: { string: string } | [ variable ]
trigger: 
- master
pr: 
- master
jobs:
  - job: packNugets
    displayName: 'nuget pack and push'
    pool:
      vmImage: 'VS2017-Win2016'

    variables:
      solution: '**/*.sln'
      buildPlatform: 'Any CPU'
      csprojBuildPlatform: 'AnyCPU'
      buildConfiguration: 'Release'
      srcRoot: './src/'
      nugetSource: 'https://api.nuget.org/v3/index.json'
      corePrj: 'Suites.Core'
      autoMapperPrj: 'Suites.AutoMapper'
      mediatRPrj: 'Suites.MediatR'
      prismPrj: 'Suites.Prism.Wpf.Fx'
      winPrj: 'Suites.WindowsPlatform'
      wpfAppPrj: 'Suites.Wpf.App'
      wpfCorePrj: 'Suites.Wpf.Core'
      visionPrj: 'Suites.Vision'
      avalonEditPrj: 'Suites.Wpf.AvalonEdit'
      netcoreapp: 'Suites.Microsoft.NetCore.App'
      controls: 'Suites.Wpf.Controls'

    steps:
    - task: DotNetCoreInstaller@0
      inputs:
        packageType: 'sdk' # Options: runtime, sdk
        version: '2.2.101'

    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(corePrj)/$(corePrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(autoMapperPrj)/$(autoMapperPrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(mediatRPrj)/$(mediatRPrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(netcoreapp)/$(netcoreapp).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(prismPrj)/$(prismPrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(winPrj)/$(winPrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(wpfCorePrj)/$(wpfCorePrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(visionPrj)/$(visionPrj).csproj
    #- script: dotnet pack -c $(buildConfiguration) -o $(Build.ArtifactStagingDirectory) $(srcRoot)$(avalonEditPrj)/$(avalonEditPrj).csproj

    - script: dotnet restore $(srcRoot)$(visionPrj)/$(visionPrj).csproj
    - task: NuGetToolInstaller@0
      inputs:
        versionSpec: '4.9.2'
    - task: NuGetCommand@2
      inputs:
        command: 'restore'
        restoreSolution: $(srcRoot)$(controls)/$(controls).csproj
        feedsToUse: 'select'
        includeNuGetOrg: true
    - task: VSBuild@1
      inputs: 
        solution: $(srcRoot)$(controls)/$(controls).csproj
        configuration: $(buildConfiguration)
        platform: '$(csprojBuildPlatform)'
    - task: NuGetCommand@2
      inputs:
        command: pack
        packagesToPack: $(srcRoot)$(controls)/$(controls).csproj.nuspec
        configuration: $(buildConfiguration)
        packDestination: $(Build.ArtifactStagingDirectory)

    #- task: NuGetToolInstaller@0
    #- task: NuGetCommand@2
      #inputs:
        #command: 'restore'
        #restoreSolution: $(srcRoot)$(wpfAppPrj)/$(wpfAppPrj).csproj
        #feedsToUse: 'select'
        #includeNuGetOrg: true
    #- task: VSBuild@1
      #inputs: 
        #solution: $(srcRoot)$(wpfAppPrj)/$(wpfAppPrj).csproj
        #configuration: $(buildConfiguration)
        #platform: '$(csprojBuildPlatform)'
    #- task: NuGetCommand@2
      #inputs:
        #command: pack
        #packagesToPack: $(srcRoot)$(wpfAppPrj)/$(wpfAppPrj).csproj.nuspec
        #configuration: $(buildConfiguration)
        #packDestination: $(Build.ArtifactStagingDirectory)

    - script: dotnet nuget push $(Build.ArtifactStagingDirectory)\*.nupkg -k $(nuget.key) -s $(nugetSource) # -n